{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‚ú® –ü–æ—Å—Ç—ã —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}" />
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>‚ú® –ü–æ—Å—Ç—ã —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</h1>
      <p>–ö—Ä–∞—Å–∏–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∞—à–∏—Ö –ø–æ—Å—Ç–æ–≤ —Å –ò–ò –ø–æ–º–æ—â–Ω–∏–∫–æ–º</p>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-number">{{ posts_list|length }}</div>
        <div class="stat-label">–ü–æ—Å—Ç–æ–≤</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">ü§ñ</div>
        <div class="stat-label">–ò–ò –ü–æ–º–æ—â–Ω–∏–∫</div>
      </div>
    </div>

    <!-- –ü–æ–∏—Å–∫ -->
    <div class="search-container">
      <form method="get" class="search-form">
        <input type="text" class="search-box" name="query" value="{{ query }}" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é..." />
        <button type="submit" class="search-btn">üîç –ù–∞–π—Ç–∏</button>
      </form>
    </div>

    <!-- –ò–ò –ø–æ–º–æ—â–Ω–∏–∫ -->
    <div class="ai-container">
      <div class="ai-title">ü§ñ –ò–ò –ü–æ–º–æ—â–Ω–∏–∫</div>
      <form id="ai-form" class="ai-form">
        <input type="text" id="ai-message" class="ai-input" placeholder="–°–ø—Ä–æ—Å–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å —É –ò–ò..." required />
        <button type="submit" id="ai-submit" class="ai-submit-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </form>
      <div id="ai-response" class="ai-response"></div>
    </div>

    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞ -->
    <div class="add-post-container form-hidden" id="addPostForm">
      <div class="add-post-title">‚úçÔ∏è –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç</div>
      <form method="post">
        {% csrf_token %}
        <div class="form-group">
          <label class="form-label" for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
          <input type="text" class="form-input" name="title" id="title" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞" required />
        </div>
        <div class="form-group">
          <label class="form-label" for="text">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:</label>
          <textarea class="form-input form-textarea" name="text" id="text" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –ø–æ—Å—Ç..." required></textarea>
        </div>
        <button type="submit" class="submit-btn">üìù –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç</button>
      </form>
    </div>

    <!-- –ü–æ—Å—Ç—ã -->
    <div class="posts-grid" id="postsContainer">
      {% for post in posts_list %}
      <div class="post-card">
        <div class="post-title">{{ post.title }}</div>
        <div class="post-content collapsed" id="content-{{ forloop.counter }}">{{ post.text|linebreaks }}</div>
        <button class="read-more-btn show" onclick="toggleReadMore({{ forloop.counter }})">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ</button>
        <div class="post-footer">
          <div class="likes" onclick="toggleLike(this)">‚ù§Ô∏è <span>0</span></div>
          <div class="time">
            {% if post.created_at %}
              {{ post.created_at|timesince }} –Ω–∞–∑–∞–¥
            {% else %}
              –ù–µ–¥–∞–≤–Ω–æ
            {% endif %}
          </div>
        </div>
      </div>
      {% empty %}
      <div class="empty-state">
        {% if query %}
          <h2>üîç –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h2>
          <p>–ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ query }}" –ø–æ—Å—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
          <p><a href="{% url 'posts' %}">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø–æ—Å—Ç—ã</a></p>
        {% else %}
          <h2>üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
          <p>–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ —Å—Ç–∞—Ç—å –ø–µ—Ä–≤—ã–º!</p>
        {% endif %}
      </div>
      {% endfor %}
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ñ–æ—Ä–º—ã -->
    <button class="toggle-form-btn" onclick="toggleAddForm()" title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç">‚úèÔ∏è</button>
  </div>

  <script>
    function toggleLike(element) {
      const span = element.querySelector('span');
      let count = parseInt(span.textContent);
      count = count === 0 ? 1 : 0;
      span.textContent = count;
      element.style.color = count > 0 ? '#e74c3c' : '#666';
    }

    function toggleAddForm() {
      const form = document.getElementById('addPostForm');
      const btn = document.querySelector('.toggle-form-btn');
      if (form.classList.contains('form-hidden')) {
        form.classList.remove('form-hidden');
        btn.innerHTML = '‚úñÔ∏è';
        btn.title = '–ó–∞–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É';
        form.scrollIntoView({ behavior: 'smooth' });
      } else {
        form.classList.add('form-hidden');
        btn.innerHTML = '‚úèÔ∏è';
        btn.title = '–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç';
      }
    }

    function toggleReadMore(id) {
      const content = document.getElementById(`content-${id}`);
      const btn = content.nextElementSibling;
      if (content.classList.contains('collapsed')) {
        content.classList.remove('collapsed');
        btn.textContent = '–°–∫—Ä—ã—Ç—å';
      } else {
        content.classList.add('collapsed');
        btn.textContent = '–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ';
      }
    }

    document.addEventListener('DOMContentLoaded', function () {
      const searchBox = document.querySelector('.search-box');
      if (searchBox && !searchBox.value) {
        searchBox.focus();
      }
    });
  </script>
</body>
</html>
