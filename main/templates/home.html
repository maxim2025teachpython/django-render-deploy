{% extends 'base.html' %}
{% block content %}
<section class="welcome-section">
  <h2>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä Dota 2!</h2>
  <p>–ó–¥–µ—Å—å —Ç—ã –Ω–∞–π–¥—ë—à—å –≤—Å—ë: –æ—Ç –≥–µ—Ä–æ–µ–≤ –∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–æ –≥–∞–π–¥–æ–≤ –∏ –∫–æ–Ω—Ç—Ä-–ø–∏–∫–æ–≤. –ò—Å—Å–ª–µ–¥—É–π, —É—á–∏—Å—å –∏ –ø–æ–±–µ–∂–¥–∞–π!</p>

  <div class="home-links">
    <a href="{% url 'heroes' %}" class="home-card">
      <h3>üßô –ì–µ—Ä–æ–∏</h3>
      <p>–û–ø–∏—Å–∞–Ω–∏–µ, —Ä–æ–ª–∏, —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ –ª—É—á—à–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.</p>
    </a>
    <a href="{% url 'items' %}" class="home-card">
      <h3>üõ°Ô∏è –ü—Ä–µ–¥–º–µ—Ç—ã</h3>
      <p>–í—Å–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: –æ—Ç —Å–∞–ø–ø–æ—Ä—Ç–æ–≤ –¥–æ –∫–µ—Ä—Ä–∏.</p>
    </a>
    <a href="{% url 'guides' %}" class="home-card">
      <h3>üìò –ì–∞–π–¥—ã</h3>
      <p>–ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã, –±–∏–ª–¥—ã –∏ –º–µ—Ö–∞–Ω–∏–∫–∏ –∏–≥—Ä—ã.</p>
    </a>
    <a href="{% url 'counters' %}" class="home-card">
      <h3>‚öîÔ∏è –ö–æ–Ω—Ç—Ä-–ø–∏–∫–∏</h3>
      <p>–ö–æ–≥–æ –±—Ä–∞—Ç—å –ø—Ä–æ—Ç–∏–≤ –∫–æ–≥–æ? –ö–æ–Ω—Ç—Ä-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ –º–µ—Ç–∞.</p>
    </a>
  </div>

  {% if ai_available %}
  <section class="ai-section">
    <h2>ü§ñ –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫</h2>
    <p>–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å, –∏ —è –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –ø–æ–º–æ—á—å!</p>
    <textarea id="ai-message" placeholder="–ù–∞–ø–∏—à–∏ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å..." rows="4" cols="50"></textarea><br>
    <button onclick="sendToAI()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <div id="ai-response" class="ai-response"></div>
  </section>
  {% else %}
    <p style="color: gray;">–ò–ò-–ø–æ–º–æ—â–Ω–∏–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.</p>
  {% endif %}
</section>

<script>
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let cookie of cookies) {
      cookie = cookie.trim();
      if (cookie.startsWith(name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

function sendToAI() {
  const message = document.getElementById('ai-message').value;
  const responseDiv = document.getElementById('ai-response');

  responseDiv.className = 'ai-response loading';
  responseDiv.innerText = '‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é...';

  fetch('/ai_chat/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCookie('csrftoken')
    },
    body: JSON.stringify({ message: message })
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      responseDiv.className = 'ai-response';
      responseDiv.innerText = data.response;
    } else {
      responseDiv.className = 'ai-response error';
      responseDiv.innerText = '‚ö†Ô∏è –û—à–∏–±–∫–∞: ' + data.error;
    }
  })
  .catch(error => {
    responseDiv.className = 'ai-response error';
    responseDiv.innerText = '‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞.';
    console.error(error);
  });
}
</script>
{% endblock %}
